<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IBM Cloud Account Management</title>
    
</head>
<body>
<!-- load the d3.js library --> 
<script src="https://d3js.org/d3.v6.min.js"></script>
<script>
var urlParams = new URLSearchParams(window.location.search);
report_name=urlParams.get('report_name')
nameparts=report_name.split("_")
report_prefix=nameparts[0]
billing_date=nameparts[1]
group_by=nameparts[2]
ts=nameparts[3]

console.log(report_prefix)
console.log(report_name)
console.log(billing_date)

function tabulate(data, columns, columnNames) {
    body = d3.select('body')
    body.append("h3").text("Billing Report - "+billing_date)
    
    var table = body.append('table')
    var thead = table.append('thead')
    var	tbody = table.append('tbody');
    // append the header row
    thead.append('tr')
        .selectAll('th')
        .data(columnNames).enter()
        .append('th')
        .text(function (column) { return column; });

    // create a row for each object in the data
    var rows = tbody.selectAll('tr')
        .data(data)
        .enter()
        .append('tr');

    // create a cell in each row for each column
    var cells = rows.selectAll('td')
        .data(function (row) {
        return columns.map(function (column) {
            return {column: column, value: row[column]};
        });
        })
        .enter()
        .append('td')
        .text(function (d) { return d.value; });

	return table;
}
</script>
<script>
d3.select("p").style("color", "green");

// 0,1,2,3
// 0, resource_id,resource_name,resource_billable_cost
d3.csv(report_name).then(function(line_items, error) {
    console.log('Monthly Billing Report');
    // remove first line
    var line_items_1 = line_items.slice(1);

    // resource_id,resource_name,resource_billable_cost
    data = line_items_1.slice().sort( (a, b) => d3.descending(parseInt(a[2]), parseInt(b[2])));
    columns = [
        "0","1","2"
    ];
    
    console.log(data)
    columnNames = ["resource_id","resource_name","billable_cost"]
    tabulate(data, columns, columnNames);

});

</script>
</body>
</html>